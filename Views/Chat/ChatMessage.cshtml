@using FoodSharing.Models.Chat
@using System.Globalization
@model MessagesHistoryView

<style>
    .chat-form{
        height: 400px;
    }
    .left{
        border-radius: 15px;
        background-color: #fbfbfb;
    }
    .right{
        border-radius: 15px;
        background-color: rgba(57, 192, 237,.2);
    }
    .image-avatar{
        width: 45px;
        height: 100%;
    }
    .section::-webkit-scrollbar {
        width: 10px;
    }
    .section::-webkit-scrollbar-track {
        background-color: #ffffff;
        border-radius: 100px;
    }
    .section::-webkit-scrollbar-thumb {
        border-radius: 100px;
        border: 2px solid transparent;
        background-clip: content-box;
        background-color: #8070d4;
    }
    .card-footer{
        background-color: hsla(0,0%,100%,0);
        border-top: 2px solid #f5f5f5;
    }
    .btn-send{
        border-radius: 20px;
    }
    .message-time{
      font-size: 0.750em;  
      color : #9c9c9c;
    }
</style>



<div class="row justify-content-center">
    <div class="col-lg-4 ">
        <div class="card " style="border-radius: 15px;">
            <div class="card-header d-flex p-3 bg-info text-white border-bottom-0 justify-content-between;"
                 style="border-top-left-radius: 15px; border-top-right-radius: 15px;">
                <i class="bi bi-chevron-left" onclick="location.href='@Url.Action("ChatUsers", "Chat")'"></i>
                <p class="mb-0 fw-bold">Live chat</p>
                <i class="bi bi-person-circle"></i>
            </div>

            <div id="chatmessage" class="section card-body p-4"  style="position: relative; height: 400px; overflow: auto;">
                @foreach (MessageView message in Model.Messages)
                {

                    @if (Model.FromUserId == message.FromUserId)
                    {
                        <div class="d-flex flex-row justify-content-end mb-4">
                            <div class="p-3 me-3 right">
                                <p class="small mb-0">@message.Content</p>
                                 <p class="message-time mb-0">@message.CreatedAt.ToString("HH:mm")</p>
                            </div>
                            <img class="image-avatar rounded-circle " src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.FromUserAvatar ))">
                        </div>
                    }
                    else
                    {
                        <div class="d-flex flex-row justify-content-start mb-4">
                            <img class="image-avatar rounded-circle" src="data:image/jpeg;base64,@(Convert.ToBase64String(Model.ToUserAvatar ))">
                            <div class="p-3 ms-3 border left">
                                <p class="small mb-0">@message.Content</p>
                                <p class="message-time mb-0">@message.CreatedAt.ToString("HH:mm")</p>
                            </div>
                        </div>
                    }
                }
            </div>

            <div class="card-footer">
                <div class="icontext mb-3 w-100 ">
                    <textarea class="form-control" type="text" id="messageInput" placeholder="Сообщение"></textarea>
                </div>

                <div class="row mb-2 px-2">
                    <button class="btn-send btn btn-success" name="@Model.ToUserId" id="sendButton">Отправить сообщение</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/js/ChatMessage.js"></script>
<script src="~/lib/signalr/dist/browser/signalr.js"></script>
<script src="~/js/chat.js"></script>